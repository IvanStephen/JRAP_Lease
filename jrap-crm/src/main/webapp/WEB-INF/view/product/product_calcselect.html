<#--
* description: 产品测算
* version: 2.0
* author:ivan_stephen@sina.cn
* #{copyright}#
*
-->
<#include "../include/header.html">
<body>
<script src="${base.contextPath}/lib/bootstrap-3.3.7/js/bootstrap.min.js"></script>
<script>
    viewModel = new kendo.observable({
        model: {
        }
    });
</script>
<div class="col-sm-6" style="margin-top: 10px;">
    <div style="padding:15px 15px 0">
        <div class="panel">
            <form class="form-horizontal" id="form-query" style="width:100%">
                <div class="form-group" style="padding-top: 10px">
                    <label class="col-sm-4 control-label"><@spring.message "product.product"/></label>
                    <div class="col-sm-8">
                        <input id="productCode" name="productCode" type=text
                               data-bind="value:model.productCode"
                               data-label="<@spring.message 'product.productcode'/>"
                               style="width:100%"
                               required
                        />
                    </div>
                    <script>
                        $("#productCode").kendoLov($.extend(${lovProvider.getLov(base.contextPath, base.locale, "LOV_PRODUCT")}, {
                            query: function (e) {
                                e.param['enabledFlag'] = 'Y';
                            },
                            select: function (e) {
                                var item = e.item;
                                // 查询头信息
                                viewModel.model.set("productCode", item.productCode);
                                viewModel.model.set("productName", item.productName);
                                viewModel.model.set("version", item.version);
                            }
                        }));
                    </script>
                </div>
                <div class="form-group">
                    <label class="col-sm-4 control-label"><@spring.message "product.productname"/></label>
                    <div class="col-sm-8">
                        <input id="productName" name="receivers" type="text" readonly="true" data-bind="value:model.productName" style="width:100%"/>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-4 control-label"><@spring.message "product.version"/></label>
                    <div class="col-sm-8">
                        <input id="version" name="receivers" type="text" readonly="true" data-bind="value:model.version" style="width:100%"/>
                    </div>
                </div>
                <div class="panel-footer text-center" id="toolbar">
                            <span class="btn btn-success" onclick="submitform('template')">
                                <i class="fa fa-save" style="margin-right:3px;"></i><@spring.message "jrap.ok"/>
                            </span>
                </div>
            </form>
            <script>kendo.bind($('#form-query'), viewModel);</script>
        </div>
    </div>
</div>

<script type="text/javascript">
    var validator = $("#maintain").kendoValidator({
        valid: function (e) {
        },
        invalidMessageType: "tooltip"
    }).data("kendoValidator");

    var validator1 = $("#minortain").kendoValidator({
        valid: function (e) {
        },
        invalidMessageType: "tooltip"
    }).data("kendoValidator");

    function submitform(mode) {
        if (validator.validate() || validator1.validate()) {
            viewModel.model.set("mode", mode);
            $.ajax({
                url: '${base.contextPath}/sys/message/sendTest',
                type: "POST",
                dataType: "json",
                contentType: "application/json",
                data: kendo.stringify(viewModel.model),
                success: function (result) {
                    if (result.success) {
                        kendo.ui.showInfoDialog({
                            message: '<@spring.message "jrap.tip.success"/>'
                        }).done(function () {
                        })
                    } else {
                        kendo.ui.showErrorDialog({
                            title: $l('jrap.error'),
                            message: result.message
                        }).done(function () {
                        });
                    }
                }
            });
        }
    }
</script>
</body>
</html>